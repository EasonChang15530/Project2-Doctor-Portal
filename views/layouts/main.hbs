<!DOCTYPE html>
<html>

<head>
  <title>Login</title>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
  <link rel="stylesheet" type="text/css" href="css/util.css" />
  <link rel="stylesheet" type="text/css" href="css/main.css" />

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.3/css/bootstrap.min.css">



  <link rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/@tarekraafat/autocomplete.js@7.2.0/dist/css/autoComplete.min.css">

  <script src="https://cdn.jsdelivr.net/npm/@tarekraafat/autocomplete.js@7.2.0/dist/js/autoComplete.min.js"></script>



</head>

<body>
  {{{body}}}
  <script src="vendor/jquery/jquery-3.2.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
  <script src="vendor/bootstrap/js/bootstrap.min.js"></script>


  <script src="js/main.js"></script>
  <script src="js/index.js"></script>


</body>


<script>
  // This is the script for the search bar

  // autoComplete.js on typing event emitter
  document.querySelector("#autoComplete").addEventListener("autoComplete", event => {
    console.log(event);
  });
  // The autoComplete.js Engine instance creator
  const autoCompletejs = new autoComplete({
    data: {
      src: async () => {
        // Loading placeholder text
        document
          .querySelector("#autoComplete")
          .setAttribute("placeholder", "Loading...");
        // Fetch External Data Source
        const source = await fetch(
          "http://localhost:3000/api/patients"
        );
        const response = await source.json();

        const data = response.map((patient, index) => {
          patient.fullname = `${patient.firstname} ${patient.lastname}`;
          return patient;
        });
        // Post loading placeholder text
        document
          .querySelector("#autoComplete")
          .setAttribute("placeholder", "Patient Name");
        // Returns Fetched data
        return data;
      },
      key: ["fullname"],
      cache: false
    },
    sort: (a, b) => {
      if (a.match < b.match) return -1;
      if (a.match > b.match) return 1;
      return 0;
    },
    placeHolder: "Patient Name",
    selector: "#autoComplete",
    threshold: 0,
    debounce: 0,
    searchEngine: "strict",
    highlight: true,
    maxResults: 5,
    resultsList: {
      render: true,
      container: source => {
        source.setAttribute("id", "autoComplete_list");
      },
      destination: document.querySelector("#autoComplete"),
      position: "afterend",
      element: "ul"
    },
    resultItem: {
      content: (data, source) => {
        source.innerHTML = data.match;
      },
      element: "li"
    },
    noResults: () => {
      const result = document.createElement("li");
      result.setAttribute("class", "no_result");
      result.setAttribute("tabindex", "1");
      result.innerHTML = "No Results";
      document.querySelector("#autoComplete_list").appendChild(result);
    },
    onSelection: async feedback => {
      console.log(feedback.selection.value.fullname);
      const selection = feedback.selection.value.food;
      let fullname = feedback.selection.value.fullname;
      let id = feedback.selection.value.id;
      const source = await fetch(
        "http://localhost:3000/api/patient/" + id
      );
      const response = await source.json();
      let modal = document.querySelector("#info-modal")
      console.log("Response", response)
      console.log("MODAL", modal)
      $("#search-modal").modal("hide");
      $("#info-modal").modal("toggle");
      $("#patient-info").append("<span>" + "<strong>" + "Name: " + "</strong>" + response.lastname + " " + response.firstname  + "</span>" + "<br>" + "<span>" + "<strong>" + "Date of Birth: " +  "</strong>" + response.dob + "</span>" + "<br>" + "<span>" + "<strong>" + "Address: " + "</strong>" + response.street + ", " + response.city + ", " + response.state + ", " + response.zip + "</span>" + "<br>" + "<span>" + "<strong>" + "Phone: " +  "</strong>" + response.phone + "</span>" + "<br>" + "<br>" + "<span>" + "<strong>" + "Height: " +  "</strong>" + response.height + " in." + "</span>" + " "+ "<span>" + "<strong>" + "Weight: " +  "</strong>" + response.weight + " lbn." + "</span>" + "<br>")
      // Render selected choice to selection div
      document.querySelector(".selection").innerHTML = selection;
      // Clear Input
      document.querySelector("#autoComplete").value = "";
      // Change placeholder with the selected value
      document
        .querySelector("#autoComplete")
        .setAttribute("placeholder", selection);
      // Concole log autoComplete data feedback
      console.log(feedback);
    }
  });

  // Toggle Search Engine Type/Mode
  document.querySelector(".toggeler").addEventListener("click", function () {
    // Holdes the toggle buttin alignment
    const toggele = document.querySelector(".toggele").style.justifyContent;

    if (toggele === "flex-start" || toggele === "") {
      // Set Search Engine mode to Loose
      document.querySelector(".toggele").style.justifyContent = "flex-end";
      document.querySelector(".toggeler").innerHTML = "Loose";
      autoCompletejs.searchEngine = "loose";
    } else {
      // Set Search Engine mode to Strict
      document.querySelector(".toggele").style.justifyContent = "flex-start";
      document.querySelector(".toggeler").innerHTML = "Strict";
      autoCompletejs.searchEngine = "strict";
    }
  });

  // Toggle results list and other elements
  const action = function (action) {
    const github = document.querySelector(".github-corner");
    const title = document.querySelector("h1");
    const mode = document.querySelector(".mode");
    const selection = document.querySelector(".selection");
    const footer = document.querySelector(".footer");

    if (action === "dim") {
      github.style.opacity = 1;
      title.style.opacity = 1;
      mode.style.opacity = 1;
      selection.style.opacity = 1;
      footer.style.opacity = 1;
    } else {
      github.style.opacity = 0.1;
      title.style.opacity = 0.3;
      mode.style.opacity = 0.2;
      selection.style.opacity = 0.1;
      footer.style.opacity = 0.1;
    }
  };

  // Toggle event for search input
  // showing & hidding results list onfocus / blur
  ["focus", "blur"].forEach(function (eventType) {
    const resultsList = document.querySelector("#autoComplete_list");

    document.querySelector("#autoComplete").addEventListener(eventType, function () {
      // Hide results list & show other elemennts
      if (eventType === "blur") {
        action("dim");
        resultsList.style.display = "none";
      } else if (eventType === "focus") {
        // Show results list & hide other elemennts
        action("light");
        resultsList.style.display = "block";
      }
    });
  });


</script>



</html>